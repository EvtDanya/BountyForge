# BountyForge

```
bountyforge/
├── app/                  # Основной код
│   ├── modules/          # Модули (разведка, сканирование и т.д.)
│   ├── api/              # API сервер
│   ├── core/             # Логика и настройки
│   └── utils/            # Вспомогательные функции
├── tests/                # Тесты
├── docker/               # Docker файлы
├── frontend/             # Веб-панель
└── README.md             # Документация
```

## Структура проекта

    ├── .docker                         /* утилиты, скрипты и конфигурационные файлы для использования в среде Docker  */
    │   ├── tls-gen                     /* набор утилит для генерации ssl сертификатов и ключей, из набора утилит rabbitmq */
    │   ├── gen-certs.sh                /* скрипт генерации ssl сертификатов и ключей для сервера rabbitmq */
    │   ├── rabbitmq-plugins            /* конфигурация плагинов сервера rabbitmq. Используется с docker compose */
    │   ├── rabbitmq.conf               /* конфигурация сервера rabbitmq. Используется с docker compose */
    ├── .old_sites_structure            /* copy of previous code structure */
    ├── src
    │   ├── dockertrap                  /* python пакет, содержащий код ловушки */
    │   │   ├── publishers              /* python пакет, содержащий классы публикаторов (связь с сервером HoneyCorn) */
    │   │   ├── routes                  /* python пакет, содержащий эндпоинты web-приложения */
    │   │   ├── scripts                 /* произвольные скрипты, использующие основной пакет ловушки */
    |   |   |   ├── ...
    │   │   |   ├── run.py              /* python скрипт, использующийся для запуска ловушки, создания исполняемого файла */
    │   ├── utils                       /* python пакет, содержащий набор утилит, использующихся в приложении */
    |   |   ├── ...
    │   |   ├── sender.py               /* модуль, содержащий класс отправки событий через публикаторы */
    │   |   ├── logging.py              /* модуль, содержащий функции инициализации системы логирования приложения */
    │   ├── config.py                   /* модуль, содержащий конфигурацию приложения */
    │   ├── main.py                     /* модуль, содержащий код инициализации ловушки */
    │   ├── schemas.py                  /* модуль, содержащий дата класс (/структуру) события, необходимого для обмена с сервером HoneyCorn  */
    ├── static                          /* json-файлы для обработки запросов на эндпоинты */
    ├── tests                           /* тесты приложения  */
    ├── build.sh                        /* скрипт сборки дистрибутива ловушки (на примере Ubuntu 20.04) */
    ├── config.yaml.dist                /* шаблон конфигурации ловушки */
    ├── docker-compose.yml              /* конфигурация для запуска ловшуки в docker окружении, содержит конфигурацию rabbitmq сервера */
    ├── docker-example.env              /* пример переменных окружения для использования c docker compose */
    ├── Dockerfile                      /* шаблон для сборки Docker образа ловушки */
    ├── install.sh                      /* скрипт установки ловушки из дистрибутива, созданного build.sh (копируется в дистрибутив автоматически)*/
    ├── Jenkinsfile                     /* конфигурация для сборки исполняемого файла \ дистрибутива ловушки с помощью Jenkins  */
    ├── Makefile                        /* конфигурация для сборки исполняемого файла \ дистрибутива ловушки с помощью PyInstaller  */
    ├── poetry.lock                     /* описание используемых версий python пакетов */
    ├── pyproject.toml                  /* конфигурация python пакета ловушки */
    ├── requirements.txt                /* зависимости ловушки. Используется для установки через pip install */


## Варианты запуска

### Docker

Запуск в Docker окружении, позволяет взаимодействовать с локальным rabbitmq сервером с аналогичными HoneyCorn серверу настройками.

1. Установите последнюю версию docker для Linux, либо Docker Desktop для Windows или MacOS.
2. Создайте файл `.env` в корневой директории шаблона, скопируйте содержимое `docker-example.env` в `.env`.
3. Запустите доступный терминал коммандной строки, перейдите в папку `.docker` и сгенерируйте сертификаты с помощью команды `bash gen-certs.sh` (см. требования к запуску в _.docker/tls-gen/README.md_).
4. В терминале перейдите в корневую директории шаблона и выполните `docker compose up -d`.
5. Изменения в коде шаблона `src/dockertrap` будут применены после перезагрузки контейнера с ловушкой.


### Python env

1. Создать venv окружение: `python3 -m venv env`
2. Активируйте venv окружение: `source env/bin/activate` (*linux)
3. Установите необходимые зависимости: `python -m pip install -r requirements.txt && poetry install`
4. Скопируйте содержимое `config.yaml.dist` в новый файл `config.yaml`, отредактируйте содержимое
5. Запустите ловушку: `PYTHONPATH=$(pwd)/src python3 src/dockertrap/scripts/run.py` (*linux)
